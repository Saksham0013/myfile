<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product List</title>
    <link rel="stylesheet" href="home-fetch.css">
</head>

<body>
    <div id="product-list"></div> <!-- This is where all products will be listed -->

    <div id="product-detail"></div> <!-- This is where a single product will be displayed -->

    <script>
        let products = [];

        // Fetch products data
        fetch('https://dummyjson.com/products')
            .then(response => response.json())
            .then(data => {
                products = data.products;
                // Display based on whether there's an ID in the URL
                const urlParams = new URLSearchParams(window.location.search);
                const productId = parseInt(urlParams.get('id'), 10);

                if (!isNaN(productId) && productId >= 0 && productId < products.length) {
                    // If an ID is provided in the URL, show that product
                    displaySingleProduct(products[productId]);
                } else {
                    // If no ID or invalid ID, show the list of all products
                    displayProductList();
                }
            })
            .catch(error => console.error('Error fetching data:', error));

        // Display the list of all products
        function displayProductList() {
            const productListDiv = document.getElementById('product-list');
            productListDiv.innerHTML = ''; // Clear the existing list

            products.forEach((product, index) => {
                const productElement = document.createElement('div');
                productElement.innerHTML = `
                    <h3><a href="#" onclick="navigateToProductPage(${index})">${product.title}</a></h3>
                    <p>${product.description}</p>
                `;
                productListDiv.appendChild(productElement);
            });
        }

        // Display a single product based on the ID
        function displaySingleProduct(product) {
            const productDetailDiv = document.getElementById('product-detail');
            productDetailDiv.innerHTML = ''; // Clear the previous product detail

            let productList = '<div class="abc">';

            if (product) {
                const productElement = document.createElement('div');
                productElement.innerHTML = `
                <div class="card">
                    <div class="inner_card">
                        <img src="${product.thumbnail}" alt="${product.title}" style="width: 200px; height: auto;">
                        <h3>${product.title}</h3>
                        <p>${product.description}</p>
                        <div class="brand"><strong>Brand:</strong> ${product.brand}</div>
                        <div class="price"><strong>Price:</strong> $${product.price}</div>
                        <div class="width"><strong>Width:</strong> ${product.dimensions.width}</div>
                        <div class="height"><strong>Height:</strong> ${product.dimensions.height}</div>
                        <div class="depth"><strong>Depth:</strong> ${product.dimensions.depth}</div>
                        <div class="warrantyInformation"><strong>WarrantyInformation:</strong> ${product.warrantyInformation}</div>
                        <div class="shippingInformation"><strong>ShippingInformation:</strong> ${product.shippingInformation}</div>
                        <div class="availabilityStatus"><strong>AvailabilityStatus:</strong> ${product.availabilityStatus}</div>
                        <div class="returnPolicy"><strong>ReturnPolicy:</strong> ${product.returnPolicy}</div>
                        <div class="discountPercentage"><strong>DiscountPercentage:</strong> ${product.discountPercentage}</div>
                        <div class="stock"><strong>Stock:</strong> ${product.stock}</div>
                        <h3>Reviews:</h3>
                        <div id="reviews-container"></div>
                    </div>
                </div>
                `;
                productDetailDiv.appendChild(productElement);

                // Fetch real reviews
                fetch(`https://dummyjson.com/products/${product.id}/`)
                    .then(response => response.json())
                    .then(data => {
                        displayReviews(data.reviews);
                    })
                    .catch(error => {
                        console.error('Error fetching reviews:', error);
                        document.getElementById('reviews-container').innerHTML = '<p>Failed to load reviews.</p>';
                    });

            }
        }

        // Function to display real reviews
        function displayReviews(reviews) {
            const reviewsContainer = document.getElementById('reviews-container');
            reviewsContainer.innerHTML = '';

            if (reviews.length > 0) {
                reviews.forEach(review => {
                    const reviewElement = document.createElement('div');
                    reviewElement.classList.add('review');
                    reviewElement.innerHTML = `
                <p><strong>${review.date}</strong></p>
                <p><strong>${review.reviewerName}</strong> (${review.rating}/5)</p>
                <p><strong>${review.reviewerEmail}</strong>
                <p>${review.comment}</p>
                <hr>
            `;
                    reviewsContainer.appendChild(reviewElement);
                });
            } else {
                reviewsContainer.innerHTML = '<p>No reviews available.</p>';
            }
        }

        // Navigate to the product page by changing the URL (with ID in query parameter)
        function navigateToProductPage(id) {
            window.location.href = `home.html?id=${id}`;
        }
    </script>
</body>

</html>